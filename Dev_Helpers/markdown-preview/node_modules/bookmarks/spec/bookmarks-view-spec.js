(function() {
  var WorkspaceView;

  WorkspaceView = require('atom').WorkspaceView;

  describe("Bookmarks package", function() {
    var displayBuffer, editor, editorView, _ref;
    _ref = [], editorView = _ref[0], editor = _ref[1], displayBuffer = _ref[2];
    beforeEach(function() {
      atom.workspaceView = new WorkspaceView;
      atom.workspace = atom.workspaceView.model;
      atom.workspaceView.openSync('sample.js');
      atom.workspaceView.enableKeymap();
      waitsForPromise(function() {
        return atom.packages.activatePackage('bookmarks');
      });
      return runs(function() {
        atom.workspaceView.attachToDom();
        editorView = atom.workspaceView.getActiveView();
        editor = editorView.editor;
        displayBuffer = editor.displayBuffer;
        return spyOn(atom, 'beep');
      });
    });
    describe("toggling bookmarks", function() {
      it("creates a marker when toggled", function() {
        var markers;
        editor.setCursorBufferPosition([3, 10]);
        expect(displayBuffer.findMarkers({
          "class": 'bookmark'
        }).length).toEqual(0);
        editorView.trigger('bookmarks:toggle-bookmark');
        markers = displayBuffer.findMarkers({
          "class": 'bookmark'
        });
        expect(markers.length).toEqual(1);
        return expect(markers[0].getBufferRange()).toEqual([[3, 0], [3, 0]]);
      });
      it("removes marker when toggled", function() {
        editor.setCursorBufferPosition([3, 10]);
        expect(displayBuffer.findMarkers({
          "class": 'bookmark'
        }).length).toEqual(0);
        editorView.trigger('bookmarks:toggle-bookmark');
        expect(displayBuffer.findMarkers({
          "class": 'bookmark'
        }).length).toEqual(1);
        editorView.trigger('bookmarks:toggle-bookmark');
        return expect(displayBuffer.findMarkers({
          "class": 'bookmark'
        }).length).toEqual(0);
      });
      it("toggles proper classes on proper gutter row", function() {
        var lines;
        editor.setCursorBufferPosition([3, 10]);
        expect(editorView.find('.bookmarked').length).toEqual(0);
        editorView.trigger('bookmarks:toggle-bookmark');
        lines = editorView.find('.bookmarked');
        expect(lines.length).toEqual(1);
        expect(lines).toHaveClass('line-number-3');
        editorView.trigger('bookmarks:toggle-bookmark');
        return expect(editorView.find('.bookmarked').length).toEqual(0);
      });
      return it("clears all bookmarks", function() {
        editor.setCursorBufferPosition([3, 10]);
        editorView.trigger('bookmarks:toggle-bookmark');
        editor.setCursorBufferPosition([5, 0]);
        editorView.trigger('bookmarks:toggle-bookmark');
        editorView.trigger('bookmarks:clear-bookmarks');
        expect(editorView.find('.bookmarked').length).toEqual(0);
        return expect(displayBuffer.findMarkers({
          "class": 'bookmark'
        })).toHaveLength(0);
      });
    });
    describe("when a bookmark is invalidated", function() {
      return it("creates a marker when toggled", function() {
        var markers;
        editor.setCursorBufferPosition([3, 10]);
        expect(displayBuffer.findMarkers({
          "class": 'bookmark'
        }).length).toEqual(0);
        editorView.trigger('bookmarks:toggle-bookmark');
        markers = displayBuffer.findMarkers({
          "class": 'bookmark'
        });
        expect(markers.length).toEqual(1);
        editorView.setText('');
        markers = displayBuffer.findMarkers({
          "class": 'bookmark'
        });
        return expect(markers.length).toEqual(0);
      });
    });
    describe("jumping between bookmarks", function() {
      it("doesnt die when no bookmarks", function() {
        editor.setCursorBufferPosition([5, 10]);
        editorView.trigger('bookmarks:jump-to-next-bookmark');
        expect(editor.getCursor().getBufferPosition()).toEqual([5, 10]);
        expect(atom.beep.callCount).toBe(1);
        editorView.trigger('bookmarks:jump-to-previous-bookmark');
        expect(editor.getCursor().getBufferPosition()).toEqual([5, 10]);
        return expect(atom.beep.callCount).toBe(2);
      });
      describe("with one bookmark", function() {
        beforeEach(function() {
          editor.setCursorBufferPosition([2, 0]);
          return editorView.trigger('bookmarks:toggle-bookmark');
        });
        it("jump-to-next-bookmark jumps to the right place", function() {
          editor.setCursorBufferPosition([0, 0]);
          editorView.trigger('bookmarks:jump-to-next-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
          editorView.trigger('bookmarks:jump-to-next-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
          editor.setCursorBufferPosition([5, 0]);
          editorView.trigger('bookmarks:jump-to-next-bookmark');
          return expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
        });
        return it("jump-to-previous-bookmark jumps to the right place", function() {
          editor.setCursorBufferPosition([0, 0]);
          editorView.trigger('bookmarks:jump-to-previous-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
          editorView.trigger('bookmarks:jump-to-previous-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
          editor.setCursorBufferPosition([5, 0]);
          editorView.trigger('bookmarks:jump-to-previous-bookmark');
          return expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
        });
      });
      return describe("with bookmarks", function() {
        beforeEach(function() {
          editor.setCursorBufferPosition([2, 0]);
          editorView.trigger('bookmarks:toggle-bookmark');
          editor.setCursorBufferPosition([10, 0]);
          return editorView.trigger('bookmarks:toggle-bookmark');
        });
        it("jump-to-next-bookmark finds next bookmark", function() {
          editor.setCursorBufferPosition([0, 0]);
          editorView.trigger('bookmarks:jump-to-next-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
          editorView.trigger('bookmarks:jump-to-next-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([10, 0]);
          editorView.trigger('bookmarks:jump-to-next-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
          editor.setCursorBufferPosition([11, 0]);
          editorView.trigger('bookmarks:jump-to-next-bookmark');
          return expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
        });
        return it("jump-to-previous-bookmark finds previous bookmark", function() {
          editor.setCursorBufferPosition([0, 0]);
          editorView.trigger('bookmarks:jump-to-previous-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([10, 0]);
          editorView.trigger('bookmarks:jump-to-previous-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([2, 0]);
          editorView.trigger('bookmarks:jump-to-previous-bookmark');
          expect(editor.getCursor().getBufferPosition()).toEqual([10, 0]);
          editor.setCursorBufferPosition([11, 0]);
          editorView.trigger('bookmarks:jump-to-previous-bookmark');
          return expect(editor.getCursor().getBufferPosition()).toEqual([10, 0]);
        });
      });
    });
    return describe("browsing bookmarks", function() {
      it("displays a select list of all bookmarks", function() {
        var bookmarks;
        editor.setCursorBufferPosition([0]);
        editorView.trigger('bookmarks:toggle-bookmark');
        editor.setCursorBufferPosition([2]);
        editorView.trigger('bookmarks:toggle-bookmark');
        editor.setCursorBufferPosition([4]);
        editorView.trigger('bookmarks:toggle-bookmark');
        atom.workspaceView.trigger('bookmarks:view-all');
        bookmarks = atom.workspaceView.find('.bookmarks-view');
        expect(bookmarks).toExist();
        expect(bookmarks.find('.bookmark').length).toBe(3);
        expect(bookmarks.find('.bookmark:eq(0)').find('.primary-line').text()).toBe('sample.js:1');
        expect(bookmarks.find('.bookmark:eq(0)').find('.secondary-line').text()).toBe('var quicksort = function () {');
        expect(bookmarks.find('.bookmark:eq(1)').find('.primary-line').text()).toBe('sample.js:3');
        expect(bookmarks.find('.bookmark:eq(1)').find('.secondary-line').text()).toBe('if (items.length <= 1) return items;');
        expect(bookmarks.find('.bookmark:eq(2)').find('.primary-line').text()).toBe('sample.js:5');
        return expect(bookmarks.find('.bookmark:eq(2)').find('.secondary-line').text()).toBe('while(items.length > 0) {');
      });
      return describe("when a bookmark is selected", function() {
        return it("sets the cursor to the location the bookmark", function() {
          var bookmarks;
          editor.setCursorBufferPosition([8]);
          editorView.trigger('bookmarks:toggle-bookmark');
          editor.setCursorBufferPosition([0]);
          atom.workspaceView.trigger('bookmarks:view-all');
          bookmarks = atom.workspaceView.find('.bookmarks-view');
          expect(bookmarks).toExist();
          bookmarks.find('.bookmark').mousedown().mouseup();
          return waitsFor(function() {
            return editor.getCursorBufferPosition().isEqual([8, 0]);
          });
        });
      });
    });
  });

}).call(this);

//# sourceMappingURL=/../../../../../../../../..//tmp/atom-build/Atom.app/Contents/Resources/app/node_modules/bookmarks/spec/bookmarks-view-spec.js.map
